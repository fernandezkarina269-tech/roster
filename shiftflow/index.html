<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ShiftFlow V48 - Goal-Oriented Edition</title>
    <style>
        :root {
            --shift1: #fef9c3; --shift2: #e0f2fe; --shift3: #f3f4f6;
            --podA: #ffedd5; --podB: #dbeafe; --podF: #fef3c7; --podBackup: #f3e8ff;
            --mgrCol: #e0e7ff; --goalMet: #dcfce7;
        }
        body { font-family: 'Segoe UI', sans-serif; background: #0f172a; margin: 0; padding: 0; color: #f8fafc; }
        .hidden { display: none !important; }

        /* NAV & BASE */
        .nav { background: #000; color: #fff; padding: 10px 30px; display: flex; justify-content: space-between; align-items: center; border-bottom: 5px solid #FFD700; position: sticky; top: 0; z-index: 1000; }
        #view-app { background: #f1f5f9; color: #1e293b; min-height: 100vh; display: none; }
        .btn-action { background: #334155; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-gold { background: #FFD700; color: black; }
        .btn-action:hover { opacity: 0.8; }

        /* ANALYTICS */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; padding: 10px; }
        .stat-card { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border-top: 5px solid #000; text-align: left; }
        .stat-val { font-size: 20px; font-weight: 900; color: #1e293b; margin: 5px 0; }

        /* LOGIN */
        #view-login { position: fixed; inset: 0; background: #000; display: flex; justify-content: center; align-items: center; z-index: 9999; }
        .login-card { background: #fff; color: #000; padding: 40px; width: 320px; border-radius: 15px; text-align: center; border-top: 8px solid #FFD700; }
        input, select { width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #000; border-radius: 6px; box-sizing: border-box; font-weight: bold; }

        /* TABLES */
        .pods-container { padding: 20px; display: flex; flex-direction: column; gap: 35px; }
        .pod-card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border: 1px solid #e2e8f0; }
        .pod-header { padding: 12px 20px; font-weight: 900; font-size: 16px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #eee; }
        .h-A { background: var(--podA); } .h-B { background: var(--podB); } .h-F { background: var(--podF); } 
        .h-BACKUP { background: var(--podBackup); } .h-MGR { background: var(--mgrCol); color: #3730a3; }
        .goal-status { font-size: 11px; padding: 4px 10px; border-radius: 20px; background: rgba(0,0,0,0.05); }
        .goal-success { background: var(--goalMet) !important; color: #166534 !important; border: 1px solid #bbf7d0; }
        
        .table-wrapper { overflow-x: auto; position: relative; }
        table { width: 100%; border-collapse: separate; border-spacing: 0; min-width: 1400px; }
        th { background: #1e293b; color: white; padding: 10px; font-size: 11px; }
        td { padding: 10px; text-align: center; font-weight: bold; border-bottom: 1px solid #f1f5f9; background: white; color: #334155; }
        
        .sticky-col { position: sticky; left: 0; z-index: 20; background: #fff !important; border-right: 2px solid #e2e8f0 !important; text-align: left !important; padding-left: 20px !important; }
        .sc-2 { left: 100px; } .sc-3 { left: 200px; width: 180px; }

        /* BADGES */
        .st-OFF { background: #fee2e2; color: #b91c1c; border: 1px solid #fca5a5; padding: 3px; border-radius: 4px; }
        .st-ABSENT { background: #fff7ed; color: #c2410c; border: 2px solid #ea580c; padding: 3px; border-radius: 4px; }
        .sales-tag { display: block; font-size: 10px; color: #059669; margin-top: 4px; font-style: italic; }
        .mgr-pod { display: block; font-size: 10px; background: #e0e7ff; color: #3730a3; padding: 2px; border-radius: 3px; margin-top: 4px; }

        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 2000; }
        .modal-box { background: white; padding: 25px; border-radius: 12px; width: 450px; text-align: center; border: 4px solid #000; color: #000; }
    </style>
</head>
<body>

    <div id="view-login">
        <div class="login-card">
            <h1>ShiftFlow</h1>
            <p style="font-weight:900; color:#F59E0B; font-size:11px;">DREAMART GOAL V48</p>
            <input type="text" id="user-in" placeholder="Username">
            <input type="password" id="pass-in" placeholder="Password">
            <button class="btn-action btn-gold" style="width:100%; padding:15px;" onclick="login()">LOG IN</button>
            <button onclick="bypassLogin()" style="margin-top:20px; background:red; color:white; border:none; padding:8px; border-radius:4px; font-weight:bold; cursor:pointer;">‚ö†Ô∏è BYPASS (KARINA)</button>
        </div>
    </div>

    <div id="view-app">
        <div class="nav">
            <div style="font-size:20px; font-weight:900;">DREAMART</div>
            <div>
                <span id="user-display" style="color:gold; font-weight:bold; margin-right:15px; text-transform:uppercase;"></span>
                <button class="btn-action btn-gold" onclick="openStats()">üìä STRATEGIC STATS</button>
                <button id="btn-add" class="hidden btn-action btn-gold" onclick="openAdd()">+ ADD PERSON</button>
                <button class="btn-action" onclick="location.reload()" style="background:red;">LOG OUT</button>
            </div>
        </div>

        <div style="background:white; display:flex; justify-content:center; gap:20px; padding:15px; border-bottom:1px solid #ddd;">
            <button class="btn-action" onclick="changeWeek(-1)">‚ùÆ PREV WEEK</button>
            <div id="week-label" style="font-weight:900; color:#1e293b;"></div>
            <button class="btn-action" onclick="changeWeek(1)">NEXT WEEK ‚ùØ</button>
        </div>

        <div id="pods-area" class="pods-container"></div>
    </div>

    <div id="modal-status" class="modal-overlay">
        <div class="modal-box">
            <h3 id="target-name"></h3>
            <div id="sales-ui" class="hidden" style="margin-bottom:15px; padding:15px; background:#f0fdf4; border-radius:10px;">
                <label>Daily Sales ($):</label>
                <input type="number" id="sales-amount" placeholder="0.00">
                <button class="btn-action" style="background:#10b981; width:100%;" onclick="confirmSales()">SAVE SALES</button>
            </div>
            
            <div id="mgr-assign-ui" class="hidden" style="margin-bottom:15px; padding:15px; background:#eef2ff; border-radius:10px;">
                <label>POD Assignment:</label>
                <select id="mgr-pod-sel">
                    <option value="A">POD A</option><option value="B">POD B</option>
                    <option value="F">POD F</option><option value="BACKUP">BACKUP POD</option>
                </select>
                <button class="btn-action" style="background:#4f46e5; width:100%;" onclick="confirmMgrWork()">CONFIRM ASSIGNMENT</button>
            </div>

            <div id="status-btns">
                <button id="btn-sales-trigger" class="btn-action btn-gold" style="width:100%; margin-bottom:10px;" onclick="showSalesUI()">üí∏ ADD SALES</button>
                <button class="btn-action" style="background:green; width:100%; margin-bottom:8px;" onclick="checkMgrReq('ON')">WORKING</button>
                <button class="btn-action" style="background:orange; width:100%; margin-bottom:8px;" onclick="saveStatus('ABSENT')">ABSENT</button>
                <button class="btn-action" style="background:red; width:100%;" onclick="saveStatus('OFF')">OFF</button>
            </div>
            <button class="btn-action" style="width:100%; margin-top:15px;" onclick="closeModals()">CANCEL</button>
        </div>
    </div>

    <div id="modal-stats" class="modal-overlay">
        <div class="modal-box" style="width: 800px;">
            <h2>Financial Performance (30 Days)</h2>
            <div class="stats-grid" id="stats-content"></div>
            <button class="btn-action" style="width:100%; margin-top:15px;" onclick="closeModals()">CLOSE</button>
        </div>
    </div>

    <div id="modal-add" class="modal-overlay">
        <div class="modal-box">
            <h3>Add New Person</h3>
            <input id="n-name" placeholder="Name">
            <select id="n-role"><option value="chatter">Chatter</option><option value="manager">Manager</option></select>
            <div id="chatter-details">
                <input id="n-team" placeholder="Team">
                <input id="n-model" placeholder="Model">
                <select id="n-pod"><option value="A">POD A</option><option value="B">POD B</option><option value="F">POD F</option><option value="BACKUP">BACKUP</option></select>
            </div>
            <button class="btn-action btn-gold" style="width:100%; margin-top:10px;" onclick="saveNewPerson()">SAVE</button>
            <button class="btn-action" style="width:100%; margin-top:10px;" onclick="closeModals()">CANCEL</button>
        </div>
    </div>

<script>
    const ADMINS = ["karina", "exequiel", "argenis", "andre"];
    const MANAGERS = ["shirly", "maria", "heilen", "michel", "gustavo", "rafael", "johanny", "victor", "david", "camila", "gabriel"];

    let db = { emps: [], mgrs: [], sched: {}, sales: {}, mgr_pods: {}, goals: {A: 500, B: 500, F: 500, BACKUP: 200} };
    let user = null, role = null, weekOffset = 0, cell = null;

    function init() {
        const saved = localStorage.getItem('SF_DATA_V48');
        if(saved) db = JSON.parse(saved);
        if(!db.goals) db.goals = {A: 500, B: 500, F: 500, BACKUP: 200};
    }
    init();

    function login() {
        const u = document.getElementById('user-in').value.toLowerCase().trim();
        const p = document.getElementById('pass-in').value.trim();
        if(p === '1234' && (ADMINS.includes(u) || MANAGERS.includes(u))) { user = u; role = ADMINS.includes(u) ? 'admin' : 'manager'; startApp(); }
        else alert("Denied");
    }
    function bypassLogin() { user = "karina"; role = "admin"; startApp(); }
    function startApp() { document.getElementById('view-login').style.display='none'; document.getElementById('view-app').style.display='block'; document.getElementById('user-display').innerText = user; if(role==='admin') document.getElementById('btn-add').classList.remove('hidden'); render(); }

    function getWeekDates(off) {
        const curr = new Date(); const day = curr.getDay();
        const diff = curr.getDate() - day + (day === 0 ? -6 : 1) + (off * 7);
        const mon = new Date(curr.setDate(diff)); const res = [];
        for(let i=0; i<7; i++) {
            const dt = new Date(mon); dt.setDate(mon.getDate() + i);
            res.push({ label: `${dt.getDate()}/${dt.getMonth()+1}`, key: `${dt.getFullYear()}-${dt.getMonth()+1}-${dt.getDate()}` });
        }
        return res;
    }

    function render() {
        const area = document.getElementById('pods-area'); area.innerHTML = '';
        const week = getWeekDates(weekOffset);
        document.getElementById('week-label').innerText = `DATES: ${week[0].key} - ${week[6].key}`;

        // Chatters PODS
        ['A','B','F','BACKUP'].forEach(pod => {
            const pEmps = db.emps.filter(e => e.pod === pod);
            
            // Calculate today's pod revenue for the Goal system
            const todayKey = `${new Date().getFullYear()}-${new Date().getMonth()+1}-${new Date().getDate()}`;
            let podTodaySales = 0;
            pEmps.forEach(e => podTodaySales += (db.sales[e.id] ? db.sales[e.id][todayKey] || 0 : 0));
            const goalMet = podTodaySales >= db.goals[pod];

            let h = `<div class="pod-card"><div class="pod-header h-${pod} ${goalMet ? 'goal-success' : ''}">
                <span>POD ${pod}</span>
                <span class="goal-status">Today: $${podTodaySales} / Goal: $${db.goals[pod]}</span>
                </div><div class="table-wrapper"><table><thead><tr><th class="sticky-col">TEAM</th><th class="sticky-col sc-2">MODEL</th><th class="sticky-col sc-3">CHATTER</th>`;
            week.forEach(d => h += `<th>${d.label}</th>`);
            h += `</tr></thead><tbody>`;
            pEmps.forEach(e => {
                h += `<tr><td class="sticky-col">${e.team}</td><td class="sticky-col sc-2">${e.model}</td><td class="sticky-col sc-3">${e.name}</td>`;
                week.forEach(d => {
                    const st = db.sched[e.id] ? db.sched[e.id][d.key] || 'ON' : 'ON';
                    const sales = db.sales[e.id] ? db.sales[e.id][d.key] || 0 : 0;
                    let txt = '‚óè', cls = 'st-ON';
                    if(st === 'OFF') { txt = 'OFF'; cls = 'st-OFF'; }
                    if(st === 'ABSENT') { txt = 'ABSENT'; cls = 'st-ABSENT'; }
                    h += `<td onclick="openStatus(${e.id},'${d.key}','${e.name}','chatter')" style="cursor:pointer"><span class="${cls}">${txt}</span>${sales > 0 ? `<span class="sales-tag">$${sales}</span>` : ''}</td>`;
                });
                h += `</tr>`;
            });
            area.innerHTML += h + `</tbody></table></div></div>`;
        });

        // Manager POD
        let mh = `<div class="pod-card"><div class="pod-header h-MGR">MANAGERS & BACKUP MGRS</div><div class="table-wrapper"><table><thead><tr><th class="sticky-col">ROLE</th><th class="sticky-col sc-2">--</th><th class="sticky-col sc-3">NAME</th>`;
        week.forEach(d => mh += `<th>${d.label}</th>`);
        mh += `</tr></thead><tbody>`;
        db.mgrs.forEach(m => {
            mh += `<tr><td class="sticky-col">Manager</td><td class="sticky-col sc-2">--</td><td class="sticky-col sc-3">${m.name}</td>`;
            week.forEach(d => {
                const st = db.sched[m.id] ? db.sched[m.id][d.key] || 'ON' : 'ON';
                const assigned = db.mgr_pods[m.id] ? db.mgr_pods[m.id][d.key] || '' : '';
                let txt = '‚óè', cls = 'st-ON';
                if(st === 'OFF') { txt = 'OFF'; cls = 'st-OFF'; }
                if(st === 'ABSENT') { txt = 'ABSENT'; cls = 'st-ABSENT'; }
                mh += `<td onclick="openStatus(${m.id},'${d.key}','${m.name}','manager')" style="cursor:pointer"><span class="${cls}">${txt}</span>${assigned ? `<span class="mgr-pod">POD ${assigned}</span>` : ''}</td>`;
            });
            mh += `</tr>`;
        });
        area.innerHTML += mh + `</tbody></table></div></div>`;
    }

    function openStatus(id, key, name, type) {
        cell = {id, key, name, type};
        document.getElementById('target-name').innerText = name;
        document.getElementById('sales-ui').classList.add('hidden');
        document.getElementById('mgr-assign-ui').classList.add('hidden');
        document.getElementById('status-btns').classList.remove('hidden');
        document.getElementById('btn-sales-trigger').classList.toggle('hidden', type !== 'chatter');
        document.getElementById('modal-status').style.display='flex';
    }

    function showSalesUI() { document.getElementById('status-btns').classList.add('hidden'); document.getElementById('sales-ui').classList.remove('hidden'); }
    function confirmSales() {
        const val = parseFloat(document.getElementById('sales-amount').value) || 0;
        if(!db.sales[cell.id]) db.sales[cell.id] = {};
        db.sales[cell.id][cell.key] = val;
        save(); closeModals();
    }
    function checkMgrReq(st) {
        if(cell.type === 'manager' && st === 'ON') {
            document.getElementById('status-btns').classList.add('hidden'); document.getElementById('mgr-assign-ui').classList.remove('hidden');
        } else saveStatus(st);
    }
    function confirmMgrWork() {
        const pod = document.getElementById('mgr-pod-sel').value;
        if(!db.mgr_pods[cell.id]) db.mgr_pods[cell.id] = {};
        db.mgr_pods[cell.id][cell.key] = pod;
        saveStatus('ON');
    }
    function saveStatus(st) {
        if(!db.sched[cell.id]) db.sched[cell.id] = {};
        db.sched[cell.id][cell.key] = st;
        save(); closeModals();
    }
    function saveNewPerson() {
        const n = document.getElementById('n-name').value;
        const type = document.getElementById('n-role').value;
        if(db.emps.some(e=>e.name===n) || db.mgrs.some(m=>m.name===n)) return alert("Name already exists!");
        const id = Date.now();
        if(type === 'chatter') db.emps.push({id, name: n, team: document.getElementById('n-team').value, model: document.getElementById('n-model').value, pod: document.getElementById('n-pod').value});
        else db.mgrs.push({id, name: n});
        save(); closeModals();
    }
    function openStats() {
        const now = new Date(); const dates = [];
        for(let i=0; i<30; i++) { const d = new Date(); d.setDate(now.getDate()-i); dates.push(`${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`); }
        let podRev = {A:0, B:0, F:0, BACKUP:0}, mgrRev = {};
        db.emps.forEach(e => {
            dates.forEach(date => {
                const s = db.sales[e.id] ? db.sales[e.id][date] || 0 : 0;
                podRev[e.pod] += s;
                db.mgrs.forEach(m => {
                    if(db.mgr_pods[m.id] && db.mgr_pods[m.id][date] === e.pod) {
                        mgrRev[m.name] = (mgrRev[m.name] || 0) + s;
                    }
                });
            });
        });
        const cont = document.getElementById('stats-content'); cont.innerHTML = '';
        Object.keys(podRev).forEach(p => cont.innerHTML += `<div class="stat-card"><h3>POD ${p} Revenue</h3><div class="stat-val">$${podRev[p]}</div></div>`);
        Object.keys(mgrRev).forEach(m => cont.innerHTML += `<div class="stat-card" style="border-top-color:blue"><h3>Mgr ${m} Impact</h3><div class="stat-val">$${mgrRev[m]}</div></div>`);
        document.getElementById('modal-stats').style.display='flex';
    }
    function save() { localStorage.setItem('SF_DATA_V48', JSON.stringify(db)); render(); }
    function closeModals() { document.querySelectorAll('.modal-overlay').forEach(m => m.style.display='none'); }
    function changeWeek(n) { weekOffset += n; render(); }
</script>
</body>
</html>
